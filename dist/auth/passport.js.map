{"version":3,"sources":["../../server/auth/passport.js"],"names":["serializeUser","user","done","id","deserializeUser","User","findById","then","catch","err","use","username","password","findOne","where","message","compareSync"],"mappings":";;AAAA;;;;AACA;;AACA;;;;AAEA;;;;;;AAEA;;AAEA,mBAASA,aAAT,CAAuB,UAACC,IAAD,EAAOC,IAAP,EAAgB;AACnCA,SAAK,IAAL,EAAWD,KAAKE,EAAhB;AACH,CAFD;;AAIA,mBAASC,eAAT,CAAyB,UAACD,EAAD,EAAKD,IAAL,EAAc;AACnC,qBAAGG,IAAH,CAAQC,QAAR,CAAiBH,EAAjB,EACKI,IADL,CACU;AAAA,eAAQL,KAAK,IAAL,EAAWD,IAAX,CAAR;AAAA,KADV,EAEKO,KAFL,CAEW;AAAA,eAAON,KAAKO,GAAL,EAAU,IAAV,CAAP;AAAA,KAFX;AAGH,CAJD;;AAMA,mBAASC,GAAT,CAAa,4BACT,UAACC,QAAD,EAAWC,QAAX,EAAqBV,IAArB,EAA8B;AAC1B,qBAAGG,IAAH,CACKQ,OADL,CACa,EAAEC,OAAO,EAAEH,kBAAF,EAAT,EADb,EAEKJ,IAFL,CAEU,UAACN,IAAD,EAAU;AACZ,YAAI,CAACA,IAAL,EAAW;AACP,mBAAOC,KAAK,IAAL,EAAW,KAAX,EAAkB,EAAEa,SAAS,gBAAX,EAAlB,CAAP;AACH;AACD,YAAI,CAAC,mBAAOC,WAAP,CAAmBJ,QAAnB,EAA6BX,KAAKW,QAAlC,CAAL,EAAkD;AAC9C,mBAAOV,KAAK,IAAL,EAAW,KAAX,EAAkB,EAAEa,SAAS,oBAAX,EAAlB,CAAP;AACH;;AAED,eAAOb,KAAK,IAAL,EAAWD,IAAX,CAAP;AACH,KAXL,EAYKO,KAZL,CAYW;AAAA,eAAON,KAAKO,GAAL,CAAP;AAAA,KAZX;AAaH,CAfQ,CAAb","file":"passport.js","sourcesContent":["import passport from 'passport';\r\nimport { Strategy as LocalStrategy } from 'passport-local';\r\nimport bcrypt from 'bcryptjs';\r\n\r\nimport db from '../models';\r\n\r\n// const LocalStrategy = passportLocal.Strategy;\r\n\r\npassport.serializeUser((user, done) => {\r\n    done(null, user.id);\r\n});\r\n\r\npassport.deserializeUser((id, done) => {\r\n    db.User.findById(id)\r\n        .then(user => done(null, user))\r\n        .catch(err => done(err, null));\r\n});\r\n\r\npassport.use(new LocalStrategy(\r\n    (username, password, done) => {\r\n        db.User\r\n            .findOne({ where: { username } })\r\n            .then((user) => {\r\n                if (!user) {\r\n                    return done(null, false, { message: 'Incorrect user' });\r\n                }\r\n                if (!bcrypt.compareSync(password, user.password)) {\r\n                    return done(null, false, { message: 'Incorrect password' });\r\n                }\r\n\r\n                return done(null, user);\r\n            })\r\n            .catch(err => done(err));\r\n    }\r\n));\r\n"]}